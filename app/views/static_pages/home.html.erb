<%if logged_in?%>
<div id="wrapper">
      <div id="content">
          <div id="map"></div>
      </div>
  </div>
    <script>

var map;
function initMap() {
  var bounds = new google.maps.LatLngBounds();
  var DelhiCenter = {lat: 28.6100, lng: 77.2300};
//
    //1. Karol Bagh 1.Nehru place 2.Connaught Place 3.Lajpat Nagar 4.Sarojni Nagar 5.Select City Walk
  map = new google.maps.Map(document.getElementById('map'), {
    center: DelhiCenter,
    zoom: 12
  });


  var marker = new google.maps.Marker({
      position: DelhiCenter,
      map: map,
      title: 'Hello World!'
    });

  //var contentString = //Hit a url here to get data!;
    var infowindow;
      $( document ).ready(function() {
        $.getJSON("http://localhost:3000/parkings.json", function(data, status){
            markers=setMarkers(map,data);
             infowindow=setInfoWindows(markers,data);
         });
      });
  bounds.extend(marker.position);
  map.fitBounds(bounds);
  var listener = google.maps.event.addListener(map, "idle", function () {
    map.setZoom(12);
  google.maps.event.removeListener(listener);
  });
var i=0;

  window.setInterval(function(){
    $( document ).ready(function() {
      $.getJSON("http://localhost:3000/parkings.json", function(data, status){
          // alert("Data: " + JSON.stringify(data) + "\nStatus: " + status);
          infowindow.close()
          infowindow=setInfoWindows(markers,data);
          console.log(data[0].id);
       });
    });
  }, 10000);
}



function setMarkers(map,data){

 var marker, i
 markers= new Array();
for(i=0; i<data.length;i++){
  var coordinates = {lat:parseFloat(data[i].lat) , lng: parseFloat(data[i].lng)};
  var info =data[i].name
  var marker = new google.maps.Marker({
          map: map, title: info , position: coordinates
        });
        map.setCenter(marker.getPosition())
        markers[i]=marker;
}
return markers;
}

function setInfoWindows(markers,data){


  var infowindow = new google.maps.InfoWindow({
               content: ''
           });
  for(i=0; i<data.length;i++){

  contentString=
 '<center><h3 id="firstHeading" class="firstHeading">'+data[i].name+'</h3></center>'+
 '<div id="bodyContent">'+
 '<p> Total Capacity:'+data[i].total_capacity+'</p>'+
 '<p> Filled: '+data[i].filled+'</p>'+
 '<p> Current Rate(per hour):'+0+'</p>'+
 '</div>'+
 '<a href="/parkings/'+data[i].id+'" class="btn btn-primary">Show Complete Status</a>';

// '<a href="http://localhost:3000/parkings/'+data[i].id+'" class="btn btn-primary">Show Complete Status</a>';



          var marker=markers[i];

         google.maps.event.addListener(marker,'click', (function(marker,contentString,infowindow){
         return function() {
           infowindow.close();
            infowindow.setContent(contentString);
            infowindow.open(map,marker);
         };
       })(marker,contentString,infowindow));

}
return infowindow;
}
    </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA6UmP5y2ulrLl7wgkjMi9A-WyeYyPbJBs&callback=initMap"
        async defer></script>

<%else%>

<% provide(:title, "Home") %>
<div class="center jumbotron">
<h1>Welcome to ParkEasy</h1>
<p>
  Description goes here!.
</p>

<%= link_to "Sign up now!", signup_path,class: "btn btn-lg btn-primary"%>
</div>
<%end%>
